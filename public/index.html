<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Strango â€¢ Chat with Stranger</title>
<script src="/socket.io/socket.io.js"></script>

<style>
* { box-sizing: border-box; font-family: Arial, sans-serif; }

body {
  margin: 0;
  height: 100vh;
  background: radial-gradient(circle at top, #0f172a, #020617);
  color: white;
}

.app { display: flex; height: 100vh; }

/* CHAT 60% */
.chat {
  width: 60%;
  display: flex;
  flex-direction: column;
  padding: 16px;
}

.header {
  border-bottom: 1px solid rgba(255,255,255,0.1);
  padding-bottom: 10px;
}

.header-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.status {
  color: #22c55e;
  font-size: 14px;
}

.online {
  font-size: 13px;
  opacity: 0.7;
}

/* MESSAGES */
.messages {
  flex: 1;
  margin-top: 15px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.message-row {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
}

.msg {
  max-width: 75%;
  padding: 8px 12px;
  border-radius: 10px;
  font-size: 14px;
}

.me { background: #2563eb; }
.stranger { background: #1e293b; }

.time {
  font-size: 11px;
  opacity: 0.5;
  margin-top: 2px;
}

/* TYPING */
.typing {
  font-size: 13px;
  opacity: 0.7;
  display: flex;
  align-items: center;
  gap: 6px;
}

.dots { display: flex; gap: 3px; }
.dots span {
  width: 5px;
  height: 5px;
  background: #9ca3af;
  border-radius: 50%;
  animation: blink 1.4s infinite both;
}
.dots span:nth-child(2){animation-delay:.2s}
.dots span:nth-child(3){animation-delay:.4s}

@keyframes blink {
  0%{opacity:.2} 20%{opacity:1} 100%{opacity:.2}
}

/* CONTROLS */
.controls {
  display: flex;
  gap: 8px;
  margin-top: 10px;
}

input {
  flex: 1;
  padding: 10px;
  border-radius: 6px;
  border: none;
}

.send-btn {
  padding: 10px 14px;
  background: #2563eb;
  border: none;
  color: white;
  border-radius: 6px;
}

.next-btn {
  padding: 10px 14px;
  background: linear-gradient(135deg, #22c55e, #16a34a);
  border: none;
  color: white;
  border-radius: 6px;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%{box-shadow:0 0 0 0 rgba(34,197,94,.5)}
  70%{box-shadow:0 0 0 10px rgba(34,197,94,0)}
  100%{box-shadow:0 0 0 0 rgba(34,197,94,0)}
}

/* ANIMATION */
.anim {
  width: 40%;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: .35;
}

/* MOBILE */
@media (max-width:768px){
  .app{flex-direction:column}
  .chat{width:100%}
  .anim{display:none}
}
</style>
</head>

<body>

<div class="app">
  <div class="chat">
    <div class="header">
      <div class="header-top">
        <h2>Strango</h2>
        <div id="online" class="online">ðŸ‘¥ 0 online</div>
      </div>
      <div id="status" class="status">Connecting...</div>
    </div>

    <div id="messages" class="messages"></div>

    <div class="controls">
      <button class="next-btn" onclick="next()">Next</button>
      <input id="input" placeholder="Type a message..." />
      <button class="send-btn" onclick="send()">Send</button>
    </div>
  </div>

  <div class="anim">Smooth Animations</div>
</div>

<script>
const socket = io();
const messages = document.getElementById("messages");
const status = document.getElementById("status");
const online = document.getElementById("online");
const input = document.getElementById("input");

let typingEl=null, typingTimer=null;

/* ONLINE COUNT */
socket.on("online", (count)=>{
  online.textContent = `ðŸ‘¥ ${count} online`;
});

/* CONNECTION */
socket.on("waiting", ()=>{
  resetUI();
  status.textContent="â³ Waiting for stranger...";
});

socket.on("connected", ()=>{
  resetUI();
  status.textContent="ðŸŸ¢ Connected to a stranger";
});

socket.on("message",(msg)=>{
  stopTyping();
  addMessage(msg,"stranger");
});

socket.on("typing",()=>showTyping());

socket.on("stranger_left",()=>{
  status.textContent="âŒ Stranger disconnected";
  stopTyping();
});

/* SEND */
function send(){
  const t=input.value.trim();
  if(!t) return;
  addMessage(t,"me");
  socket.emit("message",t);
  input.value="";
}
input.addEventListener("keydown",e=>{if(e.key==="Enter")send()});
input.addEventListener("input",()=>socket.emit("typing"));

function next(){
  resetUI();
  socket.emit("next");
}

/* HELPERS */
function addMessage(text,who){
  const row=document.createElement("div");
  row.className="message-row";
  const b=document.createElement("div");
  b.className=`msg ${who}`;
  b.textContent=text;
  const time=document.createElement("div");
  time.className="time";
  time.textContent=new Date().toLocaleTimeString([],{
    hour:"2-digit",minute:"2-digit"
  });
  row.appendChild(b);row.appendChild(time);
  messages.appendChild(row);
  messages.scrollTop=messages.scrollHeight;
}

function showTyping(){
  if(!typingEl){
    typingEl=document.createElement("div");
    typingEl.className="typing";
    typingEl.innerHTML=`Stranger is typing<div class="dots"><span></span><span></span><span></span></div>`;
    messages.appendChild(typingEl);
  }
  clearTimeout(typingTimer);
  typingTimer=setTimeout(stopTyping,1200);
}

function stopTyping(){
  if(typingEl){typingEl.remove();typingEl=null}
}

function resetUI(){
  messages.innerHTML="";
  stopTyping();
}
</script>

</body>
</html>
