<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Strango — Free Stranger Chat India</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{background:#000;color:#fff;font-family:Arial;margin:0;padding:20px}
.main-container{display:flex;gap:20px}
.left-panel{flex:2}
.right-panel{flex:1;background:#111;padding:20px;border-radius:12px}
.chat-box{height:350px;border-radius:12px;background:#050505;padding:10px;overflow-y:auto}
.controls{margin-top:10px;display:flex;gap:10px}
.controls input{flex:1;padding:10px;border-radius:8px;border:none}
.send-btn{background:#00ff9c;border:none;padding:10px 20px;border-radius:8px;cursor:pointer}
.next-btn{background:#222;border:none;color:#fff;padding:10px 20px;border-radius:8px}
.online{color:#00ff9c;text-align:center;margin-top:10px}
.typing{color:#00ff9c;font-size:12px;margin-top:5px}
</style>
</head>

<body>

<h1>Strango — Free Stranger Chat India</h1>
<p class="subtitle">Anonymous text chat without login. Meet strangers instantly.</p>

<div class="online">Online: <span id="onlineCount">0</span></div>
<div id="statusText" style="color:#00ff9c;margin-top:6px;">Looking for stranger...</div>

<div class="main-container">

<div class="left-panel">
<div id="chat" class="chat-box"></div>
<div id="typingIndicator" class="typing"></div>

<div class="controls">
<button class="next-btn" onclick="nextStranger()">Next</button>
<input id="messageInput" placeholder="Type message..." />
<button class="send-btn" onclick="sendMessage()">Send</button>
</div>
</div>

<div class="right-panel">
<h3>Strango Utilities</h3>
<ul>
<li>Private anonymous chat</li>
<li>No login required</li>
<li>Global random matching</li>
<li>Fast lightweight design</li>
<li>Mobile friendly</li>
</ul>
</div>

</div>

<script src="/socket.io/socket.io.js"></script>

<script>
const socket = io();
const chatBox = document.getElementById("chat");
const typingIndicator = document.getElementById("typingIndicator");

/* ===== ADD MESSAGE UI ===== */
function addMessage(sender,text){
  const div=document.createElement("div");
  div.textContent = sender + ": " + text;
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}

/* ===== ONLINE COUNT ===== */
socket.on("online",(count)=>{
  document.getElementById("onlineCount").innerText = count;
});

/* ===== STATUS ===== */
socket.on("waiting",()=>{
  document.getElementById("statusText").innerText="Looking for stranger...";
});

socket.on("matched",()=>{
  document.getElementById("statusText").innerText="Stranger connected";
});

socket.on("strangerConnected",()=>{
  document.getElementById("statusText").innerText="Stranger connected";
});

socket.on("disconnect",()=>{
  document.getElementById("statusText").innerText="Looking for stranger...";
});

/* ===== RECEIVE MESSAGE ===== */
socket.on("message",(msg)=>{
  addMessage("Stranger",msg);
});

/* ===== TYPING ===== */
socket.on("typing",()=>{
  typingIndicator.innerText="Stranger typing...";
});
socket.on("stopTyping",()=>{
  typingIndicator.innerText="";
});

/* ===== SEND MESSAGE (FIXED) ===== */
function sendMessage(){
  const input=document.getElementById("messageInput");
  const text=input.value.trim();
  if(!text) return;

  addMessage("You",text);
  socket.emit("message",text);

  input.value="";
}

/* ===== NEXT ===== */
function nextStranger(){
  chatBox.innerHTML="";
  socket.emit("next");
}

/* ===== INPUT TYPING EMIT ===== */
document.getElementById("messageInput").addEventListener("input",()=>{
  socket.emit("typing");
  clearTimeout(window.typingTimer);
  window.typingTimer=setTimeout(()=>{
    socket.emit("stopTyping");
  },1000);
});
</script>

</body>
</html>
