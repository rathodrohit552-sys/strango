<!DOCTYPE html>
<html>
<head>
  <title>Strango</title>
  <script src="/socket.io/socket.io.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial;
      background: linear-gradient(135deg, #2b1b14, #3a241c);
      color: white;
    }
    header {
      padding: 16px;
      display: flex;
      justify-content: space-between;
      font-size: 22px;
    }
    #status { margin: 10px; color: #a8ffcc; }
    #typing { margin-left: 10px; font-style: italic; color: #ffd180; }
    #chat { padding: 15px; height: calc(100vh - 200px); overflow-y: auto; }
    footer { display: flex; padding: 10px; }
    input { flex: 1; padding: 10px; }
    button { margin-left: 6px; padding: 10px 14px; }
  </style>
</head>

<body>

<header>
  <div>Strango</div>
  <div>ðŸ‘¥ <span id="online">0</span></div>
</header>

<div id="status">Connecting...</div>
<div id="typing"></div>
<div id="chat"></div>

<footer>
  <button onclick="skip()">Next</button>
  <input id="msg" placeholder="Type a message..." />
  <button onclick="send()">Send</button>
</footer>

<script>
  const socket = io({ transports: ["websocket"] });

  const chat = document.getElementById("chat");
  const msg = document.getElementById("msg");
  const status = document.getElementById("status");
  const typing = document.getElementById("typing");
  const online = document.getElementById("online");

  socket.on("onlineCount", c => online.innerText = c);
  socket.on("waiting", () => status.innerText = "Waiting for stranger...");
  socket.on("matched", () => {
    status.innerText = "Connected to a stranger";
    chat.innerHTML = "";
  });

  socket.on("message", m => {
    typing.innerText = "";
    chat.innerHTML += `<p>Stranger: ${m}</p>`;
  });

  socket.on("typing", () => typing.innerText = "Stranger is typing...");
  socket.on("stopTyping", () => typing.innerText = "");

  msg.addEventListener("input", () => {
    socket.emit("typing");
    clearTimeout(window.t);
    window.t = setTimeout(() => socket.emit("stopTyping"), 700);
  });

  function send() {
    if (!msg.value.trim()) return;
    chat.innerHTML += `<p>You: ${msg.value}</p>`;
    socket.emit("message", msg.value);
    socket.emit("stopTyping");
    msg.value = "";
  }

  function skip() {
    chat.innerHTML = "";
    typing.innerText = "";
    status.innerText = "Finding new stranger...";
    socket.emit("skip");
  }
</script>

</body>
</html>
