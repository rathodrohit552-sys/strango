<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Strango — Free Stranger Chat India</title>

<style>
body{margin:0;font-family:Arial;background:#000;color:#fff;}
h1{text-align:center;margin:10px 0 5px 0;font-size:28px;}
.subtitle{text-align:center;font-size:14px;margin:0;color:#ccc;}
.online{text-align:center;color:#00ff7b;margin-top:5px;}

.main-container{width:95%;max-width:1200px;margin:15px auto;display:flex;gap:20px;}
.left-panel{flex:65%;}
.right-panel{flex:35%;}

.chat-box{background:#0f0f0f;border-radius:14px;padding:15px;height:65vh;overflow-y:auto;}
.message{margin:6px 0;padding:8px 12px;border-radius:10px;width:fit-content;max-width:80%;}
.stranger{background:#1a1a1a;}
.me{background:#25D366;color:#000;}
.status{background:#222;color:#bbb;font-size:13px;}

.controls{margin-top:10px;display:flex;gap:10px;}
input{flex:1;padding:10px;border-radius:8px;border:none;}

.send-btn{background:#00ff7b;border:none;padding:10px 14px;border-radius:8px;}
.next-btn{background:#7B3F00;color:#fff;border:none;padding:10px 14px;border-radius:8px;}

.utilities{background:#0d0d0d;padding:20px;border-radius:14px;}

.footer{text-align:center;margin-top:20px;color:#aaa;}
.footer span{margin:0 10px;cursor:pointer;text-decoration:underline;}

.modal{position:fixed;top:0;left:0;width:100%;height:100%;
background:rgba(0,0,0,0.9);display:none;justify-content:center;align-items:center;z-index:999;}

.modal-content{width:80%;max-width:800px;background:#0d0d0d;
padding:25px;border-radius:12px;max-height:80vh;overflow:auto;line-height:1.7;}

.close-btn{float:right;cursor:pointer;}
.typing{color:#aaa;font-size:13px;margin-top:6px;}
</style>
</head>

<body>

<h1>Strango — Free Stranger Chat India</h1>
<p class="subtitle">Anonymous text chat without login. Meet strangers instantly.</p>
<div class="online">Online: <span id="onlineCount">0</span></div>

<div class="main-container">

<div class="left-panel">
<div id="chat" class="chat-box"></div>
<div id="typingIndicator" class="typing"></div>

<div class="controls">
<button class="next-btn" onclick="nextStranger()">Next</button>
<input id="messageInput" placeholder="Type message..." />
<button class="send-btn" onclick="sendMessage()">Send</button>
</div>
</div>

<div class="right-panel">
<div class="utilities">
<h3>Strango Utilities</h3>
<ul>
<li>Private anonymous chat</li>
<li>No login required</li>
<li>Global random matching</li>
<li>Fast lightweight design</li>
<li>Mobile friendly</li>
</ul>
</div>
</div>

</div>

<div class="footer">
<span onclick="openModal('privacy')">Privacy</span>
<span onclick="openModal('terms')">Terms</span>
<span onclick="openModal('safety')">Safety</span>
<span onclick="openModal('about')">About</span>
</div>

<!-- ================= LEGAL MODALS ================= -->

<div id="privacy" class="modal"><div class="modal-content">
<span class="close-btn" onclick="closeModal()">X</span>
<h2>Privacy Policy – Strango</h2>
<p>Strango follows Information Technology Act, 2000 and Digital Personal Data Protection Act, 2023 principles. No permanent chat storage.</p>
</div></div>

<div id="terms" class="modal"><div class="modal-content">
<span class="close-btn" onclick="closeModal()">X</span>
<h2>Terms of Use</h2>
<p>Use Strango responsibly under IT Act 2000 and Intermediary Guidelines Rules 2021.</p>
</div></div>

<div id="safety" class="modal"><div class="modal-content">
<span class="close-btn" onclick="closeModal()">X</span>
<h2>Safety Guidelines</h2>
<p>Stay anonymous, avoid sharing personal data, and use Next if uncomfortable.</p>
</div></div>

<div id="about" class="modal"><div class="modal-content">
<span class="close-btn" onclick="closeModal()">X</span>
<h2>About Strango</h2>
<p>Lightweight anonymous stranger chat built for instant global connections.</p>
</div></div>

<!-- ⭐ CRITICAL PART THAT WAS MISSING -->
<script src="/socket.io/socket.io.js"></script>

<script>
const socket=io();
const chat=document.getElementById("chat");
const input=document.getElementById("messageInput");
input.addEventListener("keydown",e=>{
   if(e.key==="Enter" && !e.shiftKey){
      e.preventDefault();
      sendMessage();
   }
});

const typingIndicator=document.getElementById("typingIndicator");

let connected=false;
let statusDiv=null;

function clearChat(){chat.innerHTML="";statusDiv=null;}

function addMessage(text,type="stranger"){
 if(type==="status"){
   if(statusDiv){statusDiv.innerText=text;return;}
   statusDiv=document.createElement("div");
   statusDiv.className="message status";
   statusDiv.innerText=text;
   chat.appendChild(statusDiv);
   return;
 }
 const div=document.createElement("div");
 div.className="message "+type;
 div.innerText=text;
 chat.appendChild(div);
 chat.scrollTop=chat.scrollHeight;
}

function sendMessage(){
 if(!connected)return;
 if(!input.value.trim())return;
 const msg=input.value;
 socket.emit("message",msg);
 addMessage("You: "+msg,"me");
 input.value="";
}

function nextStranger(){
 connected=false;
 clearChat();
 socket.emit("next");
 addMessage("Looking for new stranger...","status");
}

socket.on("connect",()=>addMessage("Looking for stranger...","status"));

socket.on("status",msg=>{
 if(msg.toLowerCase().includes("connected"))connected=true;
 if(msg.toLowerCase().includes("disconnected"))connected=false;
 addMessage(msg,"status");
});

socket.on("message",msg=>addMessage("Stranger: "+msg,"stranger"));
socket.on("online",count=>document.getElementById("onlineCount").innerText=count);

let strangerTypingTimeout;

socket.on("typing",()=>{
   typingIndicator.innerText="Stranger is typing...";

   clearTimeout(strangerTypingTimeout);
   strangerTypingTimeout=setTimeout(()=>{
      typingIndicator.innerText="";
   },1200);
});

socket.on("stopTyping",()=>typingIndicator.innerText="");

input.addEventListener("input",()=>connected&&socket.emit("typing"));

function openModal(id){document.getElementById(id).style.display="flex";}
function closeModal(){document.querySelectorAll(".modal").forEach(m=>m.style.display="none");}
</script>

</body>
</html>
