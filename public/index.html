<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Strango — Free Stranger Chat India</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<script src="/socket.io/socket.io.js"></script>

<style>
body{
margin:0;
background:#000;
color:#fff;
font-family:Arial,Helvetica,sans-serif;
padding:30px;
}

h1{margin:0 0 6px 0;}
.subtitle{opacity:.8;margin-bottom:10px}

.online{color:#00ff9c;margin-top:8px}
#statusText{color:#00ff9c;margin-top:4px}

.chat-box{
margin-top:14px;
background:#050505;
height:420px;
border-radius:14px;
padding:14px;
overflow-y:auto;
}

.controls{
display:flex;
gap:10px;
margin-top:14px;
}

#messageInput{
flex:1;
padding:14px;
border-radius:10px;
border:none;
outline:none;
font-size:16px;
}

.send-btn{
background:#00e68a;
border:none;
padding:12px 18px;
border-radius:10px;
cursor:pointer;
}

.next-btn{
background:#222;
color:#fff;
border:none;
padding:12px 18px;
border-radius:10px;
cursor:pointer;
}

.you{color:#00ff9c}
.stranger{color:#fff}

footer{
margin-top:14px;
text-align:center;
}

footer a{
color:#00ff9c;
text-decoration:none;
margin:0 6px;
}
</style>
</head>

<body>

<h1>Strango — Free Stranger Chat India</h1>
<p class="subtitle">Anonymous text chat without login. Meet strangers instantly.</p>

<div class="online">Online: <span id="onlineCount">0</span></div>
<div id="statusText">Looking for stranger...</div>

<div id="chat" class="chat-box"></div>

<div class="controls">
<button class="next-btn" onclick="nextStranger()">Next</button>
<input id="messageInput" placeholder="Type message...">
<button class="send-btn" onclick="sendMessage()">Send</button>
</div>

<footer>
<a href="/privacy-policy.html" target="_blank">Privacy</a> |
<a href="/terms.html" target="_blank">Terms</a> |
<a href="/safety.html" target="_blank">Safety</a> |
<a href="/about-us.html" target="_blank">About</a> |
<a href="/contact.html" target="_blank">Contact</a>
</footer>

<script>
const socket = io();
const chat = document.getElementById("chat");
const statusText = document.getElementById("statusText");
const input = document.getElementById("messageInput");

let connected = false;

/* ===== ONLINE COUNT ===== */
socket.on("online",(count)=>{
document.getElementById("onlineCount").innerText=count;
});

/* ===== STATUS ===== */
socket.on("waiting",()=>{
connected=false;
statusText.innerText="Looking for stranger...";
});

socket.on("matched",()=>{
connected=true;
statusText.innerText="Stranger connected";
});

socket.on("disconnect",()=>{
connected=false;
statusText.innerText="Looking for stranger...";
});

/* ===== RECEIVE MESSAGE ===== */
socket.on("message",(msg)=>{
addMessage("Stranger",msg);
notifyIfHidden();
});

/* ===== TYPING ===== */
socket.on("typing",()=>{
statusText.innerText="Stranger typing...";
});

socket.on("stopTyping",()=>{
if(connected) statusText.innerText="Stranger connected";
});

/* ===== ADD MESSAGE UI ===== */
function addMessage(sender,text){
const div=document.createElement("div");

if(sender==="You"){
div.className="you";
div.innerText="You: "+text;
}else{
div.className="stranger";
div.innerText="Stranger: "+text;
}

chat.appendChild(div);
chat.scrollTop=chat.scrollHeight;
}

/* ===== SEND MESSAGE (SAFE FIXED VERSION) ===== */
function sendMessage(){

const text=input.value.trim();
if(!text) return;

/* BLOCK IF NOT CONNECTED */
if(!connected) return;

addMessage("You",text);
socket.emit("message",text);
input.value="";
}

/* ENTER KEY SEND */
input.addEventListener("keydown",(e)=>{
if(e.key==="Enter") sendMessage();
});

/* ===== NEXT STRANGER ===== */
function nextStranger(){
socket.emit("next");
chat.innerHTML="";
statusText.innerText="Looking for stranger...";
connected=false;
}

/* ===== TYPING EMIT ===== */
input.addEventListener("input",()=>{
if(!connected) return;
socket.emit("typing");
clearTimeout(window.typingTimer);
window.typingTimer=setTimeout(()=>{
socket.emit("stopTyping");
},1000);
});

/* ===== NEW MESSAGE NOTIFICATION ===== */
function notifyIfHidden(){
if(document.hidden){
if(Notification.permission==="granted"){
new Notification("New message on Strango");
}
}
}

if("Notification" in window){
Notification.requestPermission();
}
</script>

</body>
</html>
