<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Strango — Free Stranger Chat India</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:Arial,Helvetica,sans-serif;
  text-align:center;
}

h1{margin-top:30px;}

#chat{
  width:80%;
  margin:20px auto;
  border:1px solid #222;
  border-radius:15px;
  padding:20px;
  height:55vh;              /* ✅ fixed height — fully visible */
  overflow-y:auto;
  text-align:left;
  box-sizing:border-box;
}

.msg{
  display:inline-block;
  padding:10px 14px;
  border-radius:15px;
  margin:6px 0;
  max-width:60%;
  clear:both;
}

.you{
  background:#00e676;
  color:#000;
}

.stranger{
  background:#2b2b2b;
  color:#fff;
}

.system{
  color:#00ffc8;
  font-size:14px;
  margin:6px 0;
}

.controls{
  width:80%;
  margin:auto;
  display:flex;
  gap:10px;
  justify-content:center;
}

input{
  flex:1;
  padding:12px;
  border-radius:10px;
  border:none;
}

button{
  padding:12px 18px;
  border:none;
  border-radius:10px;
  background:#00e676;
  cursor:pointer;
}

footer{
  margin:15px 0 25px 0;
}

footer a{
  color:#00ffc8;
  text-decoration:none;
  margin:0 6px;
}
</style>
</head>

<body>

<h1>Strango — Free Stranger Chat India</h1>
<p>Anonymous text chat without login. Meet strangers instantly.</p>

<div id="chat"></div>

<div class="controls">
  <button id="next">Next</button>
  <input id="msg" placeholder="Type message...">
  <button id="send">Send</button>
</div>

<footer>
<a href="/privacy.html">Privacy</a> |
<a href="/terms.html">Terms</a> |
<a href="/safety.html">Safety</a> |
<a href="/about.html">About</a> |
<a href="/contact.html">Contact</a>
</footer>

<script src="/socket.io/socket.io.js"></script>
<script>

const socket = io();

const chat = document.getElementById("chat");
const input = document.getElementById("msg");
const sendBtn = document.getElementById("send");
const nextBtn = document.getElementById("next");

let connected=false;

/* ===== ADD MESSAGE ===== */
function addMsg(type,text){
  const div=document.createElement("div");

  if(type==="you"){
    div.className="msg you";
    div.textContent="You: "+text;
  }
  else if(type==="stranger"){
    div.className="msg stranger";
    div.textContent="Stranger: "+text;
  }
  else{
    div.className="system";
    div.textContent=text;
  }

  chat.appendChild(div);
  chat.scrollTop=chat.scrollHeight;
}

/* ===== SOCKET EVENTS ===== */

socket.on("connect",()=>{
  chat.innerHTML="";
  addMsg("system","Connected to server");
});

socket.on("online",(n)=>{
  // ONLY show latest status (no stacking)
  const old=document.querySelectorAll(".system.online");
  old.forEach(e=>e.remove());

  const s=document.createElement("div");
  s.className="system online";
  s.textContent="Online: "+n;
  chat.appendChild(s);
});

socket.on("start",()=>{
  connected=true;
  chat.innerHTML="";               /* ✅ CLEAR OLD CHAT */
  addMsg("system","Stranger connected");
});

socket.on("message",(msg)=>{
  addMsg("stranger",msg);
});

socket.on("disconnectPeer",()=>{
  connected=false;
  chat.innerHTML="";               /* ✅ CLEAR OLD CHAT */
  addMsg("system","Stranger disconnected");
});

/* ===== SEND MESSAGE ===== */

function sendMessage(){
  const text=input.value.trim();
  if(!text || !connected) return;

  socket.emit("message",text);
  addMsg("you",text);
  input.value="";
}

sendBtn.onclick=sendMessage;

input.addEventListener("keypress",e=>{
  if(e.key==="Enter"){
    e.preventDefault();
    sendMessage();
  }
});

/* ===== NEXT ===== */

nextBtn.onclick=()=>{
  socket.emit("next");
  chat.innerHTML="";               /* ✅ CLEAR CHAT WHEN NEXT */
  connected=false;
  addMsg("system","Looking for stranger...");
};

</script>
</body>
</html>
