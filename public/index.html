<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Strango — Free Stranger Chat India</title>

<style>

body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#000;
  color:#fff;
}

h1{
  text-align:center;
  margin:10px 0 5px 0;
  font-size:28px;
}

.subtitle{
  text-align:center;
  font-size:14px;
  margin:0;
  color:#ccc;
}

.online{
  text-align:center;
  color:#00ff7b;
  margin-top:5px;
}

.main-container{
  width:95%;
  max-width:1200px;
  margin:15px auto;
  display:flex;
  gap:20px;
}

.left-panel{ flex:65%; }
.right-panel{ flex:35%; }

/* ===== CHAT ===== */

.chat-box{
  background:#0f0f0f;
  border-radius:14px;
  padding:15px;
  height:65vh;
  overflow-y:auto;
  box-shadow:0 0 15px rgba(0,0,0,0.4);
}

.message{
  margin:6px 0;
  padding:8px 12px;
  border-radius:10px;
  width:fit-content;
  max-width:80%;
  font-size:14px;
}

/* Stranger bubble */
.stranger{
  background:#1a1a1a;
}

/* Your bubble */
.me{
  background:#25D366;
  color:#000;
}

/* Status bubble */
.status{
  background:#222;
  color:#bbb;
  font-size:13px;
}

/* Typing indicator */
.typing{
  font-size:13px;
  color:#aaa;
  margin-top:5px;
}

/* ===== CONTROLS ===== */

.controls{
  margin-top:10px;
  display:flex;
  align-items:center;
  gap:10px;
}

input{
  flex:1;
  padding:10px;
  border-radius:8px;
  border:none;
  outline:none;
}

/* Send button */
.send-btn{
  padding:10px 14px;
  border:none;
  border-radius:8px;
  background:#00ff7b;
  font-weight:bold;
  cursor:pointer;
}

/* ⭐ Chocolate Next button */
.next-btn{
  padding:10px 14px;
  border:none;
  border-radius:8px;
  background:#7B3F00;
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}

/* Utilities */
.utilities{
  background:#0d0d0d;
  padding:20px;
  border-radius:14px;
  box-shadow:0 0 20px rgba(0,0,0,0.4);
}

@media(max-width:900px){
  .main-container{
    flex-direction:column;
  }
}

</style>
</head>

<body>

<h1>Strango — Free Stranger Chat India</h1>
<p class="subtitle">Anonymous text chat without login. Meet strangers instantly.</p>
<div class="online">Online: <span id="onlineCount">0</span></div>

<div class="main-container">

<div class="left-panel">

<div id="chat" class="chat-box"></div>
<div id="typingIndicator" class="typing"></div>

<div class="controls">

<!-- ⭐ NEXT BUTTON LEFT -->
<button class="next-btn" onclick="nextStranger()">Next</button>

<input id="messageInput" placeholder="Type message..." />

<!-- ⭐ SEND BUTTON RIGHT -->
<button class="send-btn" onclick="sendMessage()">Send</button>

</div>

</div>

<div class="right-panel">
<div class="utilities">
<h3>Strango Utilities</h3>
<ul>
<li>Private anonymous chat</li>
<li>No login required</li>
<li>Global random matching</li>
<li>Fast lightweight design</li>
<li>Mobile friendly</li>
</ul>
</div>
</div>

</div>

<script src="/socket.io/socket.io.js"></script>
<script>

const socket = io();
const chat = document.getElementById("chat");
const input = document.getElementById("messageInput");
const typingIndicator=document.getElementById("typingIndicator");

let connected=false;
let statusDiv=null;
let typingTimeout;

/* ===== ADD MESSAGE ===== */

function addMessage(text,type="stranger"){

  if(type==="status"){
      if(statusDiv){
         statusDiv.innerText=text;
         return;
      }
      statusDiv=document.createElement("div");
      statusDiv.className="message status";
      statusDiv.innerText=text;
      chat.appendChild(statusDiv);
      chat.scrollTop=chat.scrollHeight;
      return;
  }

  const div=document.createElement("div");
  div.className="message "+type;
  div.innerText=text;
  chat.appendChild(div);
  chat.scrollTop=chat.scrollHeight;
}

/* ===== SEND ===== */

function sendMessage(){

  if(!connected){
    addMessage("⚠️ Not connected yet","status");
    return;
  }

  if(!input.value.trim()) return;

  socket.emit("message",input.value);
  addMessage(input.value,"me");
  input.value="";
}

/* ===== NEXT ===== */

function nextStranger(){
  connected=false;
  socket.emit("next");
  addMessage("Looking for new stranger...","status");
}

/* ===== TYPING DETECT ===== */

input.addEventListener("input",()=>{

  if(!connected) return;

  socket.emit("typing");

  clearTimeout(typingTimeout);
  typingTimeout=setTimeout(()=>{
      socket.emit("stopTyping");
  },1000);
});

/* ===== SOCKET EVENTS ===== */

socket.on("connect",()=>{
 addMessage("Looking for stranger...","status");
});

socket.on("status",msg=>{
 addMessage(msg,"status");

 if(msg.toLowerCase().includes("connected")){
   connected=true;
 }

 if(msg.toLowerCase().includes("disconnected")){
   connected=false;
   typingIndicator.innerText="";
 }
});

socket.on("message",msg=>{
 addMessage(msg,"stranger");
});

socket.on("online",count=>{
 document.getElementById("onlineCount").innerText=count;
});

/* ⭐ STRANGER TYPING */
socket.on("typing",()=>{
 typingIndicator.innerText="Stranger is typing...";
});

socket.on("stopTyping",()=>{
 typingIndicator.innerText="";
});

</script>

</body>
</html>
